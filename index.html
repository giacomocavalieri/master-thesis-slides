<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hugo 0.107.0"><meta charset="utf-8"><title>Gestione degli Effetti</title><meta name="author" content="Giacomo Cavalieri"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="stylesheet" href="/master-thesis-slides/reveal-js/css/reset.css"><link rel="stylesheet" href="/master-thesis-slides/reveal-js/css/reveal.css"><link rel="stylesheet" href="/master-thesis-slides/css/custom-theme.min.5ae3a22e899c12ab543604aaecf97a384dd3df8c31c45d2d18f91cdc38613c8f.css" id="theme"><link rel="stylesheet" href="/master-thesis-slides/highlight-js/github-gist.min.css"><link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet"></head><body><div class="reveal"><div class="slides"><section data-noprocess="" data-shortcode-slide="" id="titleSlide"><h1 id="gestione-degli-effetti-in-linguaggi-di-programmazione-funzionale-tecniche-di-modellazione-e-interpretazione">Gestione degli effetti in linguaggi di programmazione funzionale: tecniche di modellazione e interpretazione</h1><div class="multiCol"><div class="col"><p><strong>Relatore</strong></p><ul><li>Mirko Viroli</li></ul><p><strong>Correlatori</strong></p><ul><li>Roberto Casadei</li><li>Gianluca Aguzzi</li></ul></div><div class="col"><p><strong>Candidato</strong></p><ul><li>Giacomo Cavalieri</li></ul></div></div></section><section><h2 id="outline-della-tesi">Outline della tesi</h2><ul><li>Introduzione graduale e tramite esempi del concetto di <strong>monade</strong> e <strong>stack di monadi</strong></li><li>Analisi dell’approccio <strong>Monad Transformer Library (MTL)</strong> come meccanismo per tracciare gli effetti</li><li>Analisi dell’approccio delle <strong>free monad</strong> come meccanismo per tracciare gli effetti</li><li>Introduzione dell’approccio degli <strong>effetti algebrici</strong> e vantaggi rispetto all’approccio monadico</li></ul></section><section><h2 id="side-effect-nei-linguaggi-di-programmazione">Side effect nei linguaggi di programmazione</h2><blockquote><p>If a program has no <strong>side effects</strong> there’s no point in running it.
You have a black box, you press go and it gets hot but there’s no output!
<em>Simon Peyton-Jones</em></p></blockquote><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="k">def</span> <span class="n">appendToFile</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">log</span><span class="o">(</span><span class="nc">LogLevel</span><span class="o">.</span><span class="nc">Info</span><span class="o">,</span> <span class="s">f"Appending </span><span class="si">$line</span><span class="s"> to </span><span class="si">$file</span><span class="s">"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Using</span><span class="o">(</span><span class="nc">FileWriter</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="kc">true</span><span class="o">))(</span><span class="k">_</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">f"</span><span class="si">$line\n</span><span class="s">"</span><span class="o">))</span>
</span></span></code></pre></div></section><section><blockquote><p><strong>Side effects are lies</strong>. Your function promises to do one thing, but it also does other hidden things.
[…] They are mistruths that often result in strange temporal couplings and order dependencies.
<em>Robert Cecil Martin</em></p></blockquote><div class="multiCol"><div class="col"><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// f : Double =&gt; Double
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">def</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">appendToFile</span><span class="o">(</span><span class="s">"path/to/file"</span><span class="o">,</span> <span class="s">"Effect!"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Math</span><span class="o">.</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">=/=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span></code></pre></div></div><div class="col"><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// g : Double =&gt; Double
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">def</span> <span class="n">g</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Math</span><span class="o">.</span><span class="n">cos</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">g</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">+</span> <span class="n">g</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">g</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span></code></pre></div></div></div></section><section><h2 id="obiettivi-della-tesi">Obiettivi della tesi</h2><ul><li>Fornire una visione d’insieme sulle principali tecniche ad oggi adottate per modellare in maniera esplicita i side effect delle funzioni: <strong>Monad Transformer Library (MTL)</strong> e <strong>free monad</strong></li><li>Analizzare il nuovo approccio emergente degli <strong>effetti algebrici</strong></li><li>Mostrare l’efficacia di questi approcci come strumenti di design in un paradigma <strong>“orientato agli effetti”</strong></li></ul></section><section><h2 id="modellazione-esplicita-dei-side-effect-tramite-monadi">Modellazione esplicita dei side effect tramite monadi</h2><p>L’idea alla base di questi approcci consiste nel trasformare il programma in una struttura dati immutabile che <strong>descrive</strong> i side effect che possono verificarsi:</p><ul><li>Un programma diventa <strong>un’entità di prima classe</strong></li><li>I programmi possono essere descritti e composti in maniera <strong>modulare</strong></li><li>È possibile <strong>modificare la semantica</strong> di un programma interpretandolo diversamente</li></ul></section><section><h2 id="mtl-e-free-monad">MTL e Free Monad</h2><p>Una funzione realizzata seguendo questo approccio non “mente” sul proprio comportamento: specifica in maniera astratta i side effect che possono aver luogo</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="k">def</span> <span class="n">appendToFile</span><span class="o">[</span><span class="kt">Effs</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">FileSystem:</span> <span class="kt">Logging</span><span class="o">](</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//            ▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔ I possibili side effect
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">:</span> <span class="kt">Program</span><span class="o">[</span><span class="kt">Effs</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//  ▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔ Restituisce la descrizione di un programma
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Logging</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="nc">LogLevel</span><span class="o">.</span><span class="nc">Info</span><span class="o">,</span> <span class="s">f"Appending </span><span class="si">$line</span><span class="s"> to </span><span class="si">$file</span><span class="s">"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">FileSystem</span><span class="o">.</span><span class="n">use</span><span class="o">(</span><span class="n">file</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">f"</span><span class="si">$line\n</span><span class="s">"</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">yield</span> <span class="o">()</span>
</span></span></code></pre></div></section><section><p>Vengono disaccoppiati la <strong>descrizione</strong> del programma e la sua <strong>interpretazione</strong>: la descrizione specifica in maniera astratta <strong>quali</strong> effetti devono aver luogo e in un secondo momento è possibile stabilie <strong>come</strong> dovranno essere interpretati</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="k">def</span> <span class="n">interpret</span><span class="o">()</span> <span class="k">=</span> 
</span></span><span class="line"><span class="cl">  <span class="n">program</span><span class="o">.</span><span class="n">nextInstruction</span> <span class="k">match</span>
</span></span><span class="line"><span class="cl">    <span class="nc">Return</span><span class="o">(</span><span class="n">result</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">    <span class="nc">SideEffect</span><span class="o">(</span><span class="n">effect</span><span class="o">,</span> <span class="n">continuation</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">effect</span> <span class="k">match</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Log</span><span class="o">(</span><span class="n">logLevel</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span> 
</span></span><span class="line"><span class="cl">        <span class="n">println</span><span class="o">(</span><span class="s">f"[</span><span class="si">$logLevel</span><span class="s">] </span><span class="si">$message</span><span class="s">"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">continuation</span><span class="o">(()).</span><span class="n">interpret</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="nc">OpenFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">mode</span><span class="o">)</span>   <span class="k">=&gt;</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">      <span class="nc">CloseFile</span><span class="o">(</span><span class="n">fileHandle</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="o">...</span>
</span></span></code></pre></div></section><section><h2 id="effetti-algebrici">Effetti algebrici</h2><p>L’approccio basato su effetti algebrici ha l’obiettivo di <strong>tracciare esplicitamente e in maniera automatica</strong> gli effetti, senza dover ricorrere all’utilizzo di monadi</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// appendToFile : (string, string) -&gt; &lt;logging, fileSystem&gt; ()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fun</span> <span class="nf">appendToFile</span><span class="p">(</span><span class="k">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">log</span><span class="p">(</span><span class="nc">LogLevel</span><span class="p">.</span><span class="n">Info</span><span class="p">,</span> <span class="s2">"Appending </span><span class="si">$line</span><span class="s2"> to </span><span class="si">$file</span><span class="s2">"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">using</span><span class="p">(</span><span class="k">file</span><span class="p">)</span> <span class="p">{</span> <span class="n">fn</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="n">handle</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="p">}</span>
</span></span></code></pre></div></section><section><p>Gli approcci basati su effetti algebrici presentano diversi vantaggi rispetto alle controparti monadiche</p><ul><li>Il codice <strong>appare imperativo</strong> e non richiede complesse annotazioni di tipo</li><li><strong>Inferenza automatica</strong> dei tipi (ed effetti!)</li><li><strong>Minor carico cognitivo</strong> per il programmatore</li></ul></section><section><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// appendToFile : (String, String) =&gt; Unit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">def</span> <span class="n">appendToFile</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">log</span><span class="o">(</span><span class="nc">LogLevel</span><span class="o">.</span><span class="nc">Info</span><span class="o">,</span> <span class="s">f"Appending </span><span class="si">$line</span><span class="s"> to </span><span class="si">$file</span><span class="s">"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nc">Using</span><span class="o">(</span><span class="nc">FileWriter</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="kc">true</span><span class="o">))(</span><span class="k">_</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">f"</span><span class="si">$line\n</span><span class="s">"</span><span class="o">))</span>
</span></span></code></pre></div><span class="fragment"><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// appendToFile : (String, String) =&gt; Program[Effs, Unit]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">def</span> <span class="n">appendToFile</span><span class="o">[</span><span class="kt">Effs</span><span class="o">[</span><span class="k">_</span><span class="o">]</span><span class="kt">:</span> <span class="kt">FileSystem:</span> <span class="kt">Logging</span><span class="o">](</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">:</span> <span class="kt">Program</span><span class="o">[</span><span class="kt">Effs</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>                    
</span></span><span class="line"><span class="cl">  <span class="k">for</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Logging</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="nc">LogLevel</span><span class="o">.</span><span class="nc">Info</span><span class="o">,</span> <span class="s">f"Appending </span><span class="si">$line</span><span class="s"> to </span><span class="si">$file</span><span class="s">"</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">FileSystem</span><span class="o">.</span><span class="n">use</span><span class="o">(</span><span class="n">file</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="s">f"</span><span class="si">$line\n</span><span class="s">"</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">  <span class="k">yield</span> <span class="o">()</span>
</span></span></code></pre></div></span><span class="fragment"><div class="highlight"><pre tabindex="0" class="chroma"><code class="nohighlight" data-noescape=""><span class="line"><span class="cl"><span class="c1">// appendToFile : (string, string) -&gt; &lt;logging, fileSystem&gt; ()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">fun</span> <span class="nf">appendToFile</span><span class="p">(</span><span class="k">file</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">log</span><span class="p">(</span><span class="nc">LogLevel</span><span class="p">.</span><span class="n">Info</span><span class="p">,</span> <span class="s2">"Appending </span><span class="si">$line</span><span class="s2"> to </span><span class="si">$file</span><span class="s2">"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">using</span><span class="p">(</span><span class="k">file</span><span class="p">)</span> <span class="p">{</span> <span class="n">fn</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span> <span class="n">handle</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="p">}</span>
</span></span></code></pre></div></span></section><section><h2 id="adozione">Adozione</h2><ul><li>L’approccio monadico rappresenta lo <strong>standard de facto</strong> in linguaggi funzionali puri come Haskell</li><li>In Scala sono state sviluppate <strong>librerie che implementano l’approccio monadico</strong>: ZIO, Cats Effect, etc.</li><li>L’approccio degli effetti algebrici sta ricevendo crescente attenzione</li></ul><blockquote><p>The WasmFX project extends WebAssembly with effect handlers as a unifying mechanism to enable efficient compilation of control idioms, such as <strong>async/await, generators/iterators, first-class continuations</strong>, etc.
<em>WasmFX Overview</em></p></blockquote></section><section><blockquote><p>We’ve managed to achieve <strong>higher decoupling</strong> and independence for our various services and dev teams that have very different use-cases while maintaining a single uniform infrastructure in place. Our Kafka infrastructure is called Greyhound and was recently <strong>completely re-written using ZIO</strong>.
<em>Natan Silnitsky - Backend Infra Developer, Wix</em></p></blockquote><blockquote><p>Free Monads are fast, reliable, simple and expressive. […] This technology <strong>helped the company to grow up</strong> […] and helped us to easily reason about the domain, the logic, the business goals and requirements.
<em>Alexander Granin - Senior Software Architect, Juspay</em></p></blockquote></section><section><h2 id="conclusioni">Conclusioni</h2><ul><li>Tracciare i side effect delle funzioni ne <strong>rende esplicito il comportamento</strong>, semplificando la possibilità di ragionare sulle loro proprietà e rifattorizzare il codice</li><li>Gli effetti possono essere sfruttati come <strong>strumento di design</strong> e organizzazione del software in un paradigma “orientato agli effetti”</li><li>L’approccio basato su effetti algebrici rappresenta una promettente <strong>sintesi fra la semplicità di scrittura</strong> del codice imperativo <strong>e i vantaggi della gestione esplicita degli effetti</strong></li></ul></section></div></div><script type="text/javascript" src="/master-thesis-slides/reveal-hugo/object-assign.js"></script>
<a href="/master-thesis-slides/reveal-js/css/print/" id="print-location" style="display:none"></a>
<script type="text/javascript">var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"900","highlight_theme":"github-gist","mermaid":[{"fontFamily":"Inconsolata","startOnLoad":false,"theme":"default","useMaxWidth":false}],"pdfseparatefragments":false,"slide_number":false,"theme":"white","width":"1440"}</script><script type="application/json" id="reveal-hugo-page-params">null</script><script src="/master-thesis-slides/reveal-js/js/reveal.js"></script>
<script type="text/javascript">function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type="text/javascript" src="/master-thesis-slides/reveal-js/plugin/markdown/marked.js"></script>
<script type="text/javascript" src="/master-thesis-slides/reveal-js/plugin/markdown/markdown.js"></script>
<script type="text/javascript" src="/master-thesis-slides/reveal-js/plugin/highlight/highlight.js"></script>
<script type="text/javascript" src="/master-thesis-slides/reveal-js/plugin/zoom-js/zoom.js"></script>
<script type="text/javascript" src="/master-thesis-slides/reveal-js/plugin/notes/notes.js"></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script></body></html>